{% macro example(params) %}
{% set exampleRoot = "src/" + params.group + "/" + params.item + "/" + params.example + "/" %}
{% if params.customCode %}
  {% set examplePath = exampleRoot + "code.njk" %}
{% else %}
  {% set examplePath = exampleRoot + "index.njk" %}
{% endif %}

{% set exampleURL = "/" + params.group + "/" + params.item + "/" + params.example + "/index.html" %}
{% set exampleId = params.id | default("example-" + params.example) %}
{% set exampleTitle = getFrontmatter(examplePath).title %}
{% set frontendComponentName = params.frontendComponentName | default(params.item) %}
{% if params.open %}
  {% set exampleId = exampleId + '-open' %}
{% endif %}

{% set multipleTabs = params.html and params.nunjucks %}

<div class="app-example-wrapper js-example" id="{{ exampleId }}">
  <div class="app-example {{ "app-example--tabs" if params.html or params.nunjucks }}">
    <span class="app-example__new-window">
      <a href="{{ exampleURL }}" target="_blank">
        Open this
        <span class="govuk-visually-hidden"> "{{ exampleTitle }}" </span>
        example in a new window
      </a>
    </span>
    <iframe title="{{ exampleTitle }}" class="app-example__frame app-example__frame--resizable js-example__frame{% if params.size %} app-example__frame--{{ params.size }}{% endif %}" src="{{ exampleURL }}" frameBorder="0"></iframe>
  </div>

  {%- if (multipleTabs) %}
  <ul class="app-tabs" role="tablist">
    <li class="app-tabs__item js-tabs__item{{ " js-tabs__item--open" if (params.open) }}" role="presentation"><a href="#{{ exampleId }}-html" role="tab" aria-controls="{{ exampleId }}-html" data-track="tab-html">HTML</a></li>
    <li class="app-tabs__item js-tabs__item" role="presentation"><a href="#{{ exampleId }}-nunjucks" role="tab" aria-controls="{{ exampleId }}-nunjucks" data-track="tab-nunjucks">Nunjucks</a></li>
  </ul>
  {% endif %}

  {%- if (params.html) %}
  {%- if (multipleTabs) %}
  <div class="app-tabs__heading js-tabs__heading{{ " js-tabs__heading--open" if (params.open) }}"><a href="#{{ exampleId }}-html" role="tab" aria-controls="{{ exampleId }}-html" data-track="tab-html">HTML</a></div>
  {% endif %}
  <div class="app-tabs__container js-tabs__container" id="{{ exampleId }}-html" role="tabpanel">
    ```html
    {{ getHTMLCode(examplePath) | safe }}
    ```
  </div>
  {% endif %}

  {%- if (params.nunjucks) %}
  {%- if (multipleTabs) %}
  <div class="app-tabs__heading js-tabs__heading"><a href="#{{ exampleId }}-nunjucks" role="tab" aria-controls="{{ exampleId }}-nunjucks" data-track="tab-nunjucks">Nunjucks</a></div>
  {% endif %}

  <div class="app-tabs__container js-tabs__container" id="{{ exampleId }}-nunjucks" role="tabpanel">
    {%- if (params.group == 'components') %}

      {% set arguments = getMacroArguments("src/components/"+params.item+"/macro-arguments.json") %}

      {% set argumentsHTML %}

        <p>
          If youâ€™re using Nunjucks macros in production be aware that using html
          arguments, or ones ending with Html can be a <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">security risk</a>.
          Read more about it in the <a href="https://mozilla.github.io/nunjucks/api.html#user-defined-templates-warning">Nunjucks documentation</a>.</p>

        <table class="govuk-table">
          <caption class="govuk-table__caption govuk-visually-hidden">
              Nunjucks macro arguments
          </caption>
          <thead class="govuk-table__head">
            <tr class="govuk-table__row">
              <th class="govuk-table__header" scope="col">Name</th>
              <th class="govuk-table__header" scope="col">Type</th>
              <th class="govuk-table__header" scope="col">Description</th>
            </tr>
          </thead>
          <tbody class="govuk-table__body">
            {% for group in arguments %}

              {% if group.groupName != "" %}
                <tr class="govuk-table__row">
                  <td class="govuk-table__cell" colspan="3">
                    <h3 class="govuk-!-margin-top-5" id="nunjucks-macro-arguments-{{group.groupName}}">{{group.groupName}}</h3>
                  </td>
                </tr>
              {% endif %}

              {% for argument in group.arguments %}
                <tr class="govuk-table__row">
                  <th class="govuk-table__header" scope="row">{{argument.name}}</th>
                  <td class="govuk-table__cell ">{{argument.type}}</td>
                  <td class="govuk-table__cell ">{{argument.description | safe}}</td>
                </tr>
              {% endfor %}

            {% endfor %}

          </tbody>
        </table>

      {% endset %}

      {% from "details/macro.njk" import govukDetails %}

      {{ govukDetails({
        summaryText: "Nunjucks macro options",
        html: argumentsHTML,
        classes: "app-tabs__details",
        attributes:{
          id: "nunjucks-macro-arguments"
        }
      })}}
    {% endif %}

    ```js
    {{ getNunjucksCode(examplePath) | safe }}
    ```
  </div>
  {% endif %}
</div>

{% endmacro %}
